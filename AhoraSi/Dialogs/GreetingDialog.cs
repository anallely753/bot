using Microsoft.Bot.Builder;
using Microsoft.Bot.Builder.Dialogs;
using System;
using System.Threading;
using System.Threading.Tasks;

namespace AhoraSi.Dialogs
{
    internal class GreetingDialog : ComponentDialog
    {
        public GreetingDialog(string dialogId = null) : base(dialogId)
        {
            InitializeWaterfallDialog();
        }
        private void InitializeWaterfallDialog()
        {
            //Creamos pasos de la cascada
            var waterfallSteps = new WaterfallStep[]
            {
                InitialStepAsync,
                SetBirth,
                FinalStepAsync,
            };

            //Agregamos subdialogos
            AddDialog(new WaterfallDialog($"{nameof(GreetingDialog)}.mainFlow", waterfallSteps));
            AddDialog(new NumberPrompt<int>(nameof(NumberPrompt<int>), ValidateId));
            AddDialog(new TextPrompt(nameof(TextPrompt), ValidateBirth));
            //Indicamos con cual subdialogo comenzar
        }

       

        public class Bread
        {
            public static int pos;
            public static int bandera;
        }
        private async Task<bool> ValidateBirth(PromptValidatorContext<string> promptContext, CancellationToken cancellationToken)
        {

            string birth = promptContext.Recognized.Value;
            string[] birth_empleados = {"09/10/1969",
"26/03/1967",
"21/04/1975",
"28/01/1979",
"25/08/1967",
"16/09/1982",
"17/07/1976",
"17/03/1976",
"17/03/1977",
"07/01/1973",
"28/06/1977",
"09/07/1985",
"31/05/1978",
"29/12/1972",
"11/01/1979",
"21/05/1982",
"26/01/1971",
"22/06/1973",
"30/10/1988",
"30/01/1981",
"04/12/1975",
"04/07/1973",
"18/10/1986",
"17/03/1970",
"08/12/1982",
"02/07/1977",
"19/06/1972",
"02/11/1985",
"21/02/1974",
"06/01/1985",
"18/12/1984",
"27/04/1989",
"10/08/1990",
"18/05/1975",
"01/10/1983",
"28/12/1961",
"23/12/1964",
"03/09/1971",
"11/04/1965",
"08/09/1970",
"12/12/1963",
"03/10/1968",
"27/10/1969",
"19/07/1977",
"18/02/1988",
"02/02/1986",
"30/03/1982",
"16/06/1994",
"14/04/1985",
"02/09/1974",
"14/12/1964",
"24/08/1974",
"19/02/1992",
"30/07/1993",
"24/06/1972",
"02/10/1979",
"27/04/1984",
"28/06/1967",
"25/03/1980",
"14/02/1958",
"29/06/1972",
"11/11/1979",
"21/10/1968",
"05/06/1973",
"04/05/1981",
"26/11/1977",
"22/12/1980",
"27/11/1984",
"15/09/1979",
"16/12/1995",
"21/05/1989",
"08/10/1996",
"09/01/1976",
"07/05/1986",
"14/12/1979",
"21/12/1976",
"09/06/1989",
"16/08/1990",
"02/05/1994",
"31/05/1991",
"15/07/1984",
"04/05/1994",
"13/11/1990",
"23/06/1994",
"15/04/1992",
"29/09/1979",
"16/11/2001",
"02/05/1969",
"10/09/1980",
"07/05/1997",
"09/02/1977",
"10/08/1968",
"00/01/1900",
"12/05/1967",
"12/06/1980",
"20/04/1973",
"10/03/1990",
"21/09/1983",
"28/03/1985",
"27/03/1987",
"28/06/1984",
"14/11/1992",
"14/06/1977",
"20/09/1993",
"14/01/1976",
"24/10/1969",
"04/05/1967",
"08/08/1978",
"10/12/1982",
"17/03/1998",
"28/03/1983",
"10/01/1977",
"05/06/1990",
"00/01/1900",
"10/11/1964",
"00/01/1900",
"03/10/1987",
"16/02/1973",
"01/05/1980",
"31/01/1990",
"17/11/1971",
"10/07/1991",
"07/01/1982",
"02/10/1984",
"29/04/1981",
"18/03/1986",
"25/01/1992",
"04/08/1993",
"13/10/1979",
"00/01/1900",
"11/01/1977",
"25/05/1974",
"15/12/1973",
"06/02/1982",
"12/10/1989",
"10/03/1980",
"24/09/1982",
"05/04/1973",
"05/04/1989",
"29/01/1980",
"15/10/1998",
"06/03/1979",
"24/10/1980",
"26/06/1985",
"23/01/1979",
"27/07/1974",
"14/08/1986",
"11/01/1976",
"21/09/1975",
"10/06/1981",
"21/08/1991",
"11/11/1982",
"16/03/1995",
"14/01/1982",
"15/10/1992",
"25/12/1974",
"05/07/1995",
"22/12/1978",
"02/06/1991",
"16/05/1996",
"19/10/1997",
"28/02/1964",
"06/08/1986",
"21/11/1984",
"17/12/1985",
"11/12/1978",
"29/04/1970",
"23/04/1974",
"15/08/1989",
"22/10/1998",
"11/08/1985",
"19/01/1991",
"12/06/1977",
"20/01/1978",
"23/11/1980",
"29/07/1999",
"11/08/1973",
"31/12/1977",
"22/02/1997",
"07/06/1991",
"05/09/1995",
"07/02/1979",
"01/04/1989",
"22/12/1964",
"26/12/1994",
"19/06/1988",
"14/10/1978",
"21/06/1993",
"05/04/1997",
"04/11/1973",
"06/06/1977",
"03/06/1964",
"21/05/2002",
"24/02/1980",
"00/01/1900",
"23/07/1966",
"05/09/1981",
"25/04/1979",
"21/03/1987",
"18/09/1993",
"00/01/1900",
"19/12/1985",
"12/07/1975",
"00/01/1900",
"30/09/1974",
"09/12/1962",
"01/07/1987",
"23/03/1973",
"31/08/1980",
"03/08/1993",
"25/07/1965",
"26/04/1982",
"14/01/1982",
"16/04/1976",
"27/03/1962",
"04/04/1981",
"28/06/1985",
"11/05/1992",
"01/11/1990",
"10/02/1983",
"07/08/1993",
"02/01/1980",
"03/06/1983",
"31/01/1970",
"17/05/1987",
"01/11/1963",
"03/02/1983",
"21/12/1980",
"29/09/1983",
"11/09/1989",
"21/09/1994",
"04/10/1986",
"08/03/1989",
"20/12/1978",
"13/07/1989",
"17/02/1999",
"27/07/1989",
"25/06/1974",
"20/09/1983",
"03/12/1978",
"04/10/1977",
"20/12/1983",
"13/05/1989",
"04/10/1988",
"02/02/1987",
"09/04/1975",
"29/06/1988",
"19/11/1984",
"21/09/1980",
"07/02/1986",
"30/09/1978",
"21/06/1996",
"00/01/1900",
"25/11/1992",
"09/07/1989",
"18/11/1988",
"21/06/1979",
"27/02/1986",
"21/03/1986",
"07/05/1993",
"23/04/1992",
"18/09/1993",
"10/02/1993",
"12/04/1991",
"15/06/1991",
"00/01/1900",
"04/11/1976",
"21/06/1982",
"31/03/1989",
"20/01/1992",
"11/07/1984",
"17/12/1982",
"08/06/1992",
"26/08/1991",
"15/01/1988",
"20/04/1992",
"00/01/1900",
"03/02/1983",
"18/02/1985",
"06/12/1971",
"08/09/1975",
"20/03/1977",
"12/10/1973",
"10/03/1973",
"24/07/1994",
"23/03/1990",
"17/12/1978",
"21/09/1984",
"17/03/1983",
"22/06/1994",
"18/05/1975",
"12/08/1974",
"31/03/1982",
"29/05/1988",
"08/08/1962",
"17/10/1996",
"21/02/1978",
"07/01/1986",
"04/07/1982",
"09/04/1979",
"15/02/1987",
"16/07/1989",
"12/11/1991",
"15/05/1991",
"25/01/1986",
"29/07/1982",
"21/08/1996",
"15/10/1983",
"29/06/1986",
"03/05/1977",
"09/01/1988",
"00/01/1900",
"18/07/1983",
"30/04/1991",
"09/07/1989",
"07/07/1989",
"04/10/1978",
"22/01/1962",
"03/10/1980",
"12/09/1992",
"20/07/1986",
"30/03/1986",
"11/12/1995",
"09/01/1992",
"15/03/1983",
"00/01/1900",
"16/03/1963",
"19/04/1989",
"20/02/1970",
"12/12/1982",
"29/09/1962",
"09/04/1996",
"15/12/1985",
"09/07/1968",
"19/05/1988",
"02/09/1986",
"10/09/1989",
"07/02/2002",
"22/01/1990",
"17/08/1987",
"20/10/1976",
"16/04/1972",
"07/01/1973",
"08/06/1966",
"25/09/1963",
"26/05/1975",
"16/06/1991",
"14/05/1973",
"18/09/1988",
"17/02/1978",
"23/10/1967",
"14/11/1979",
"23/07/1993",
"12/10/1979",
"13/09/1992",
"14/08/1982",
"04/07/1978",
"24/02/1982",
"16/03/1978",
"23/03/1979",
"18/03/1990",
"15/07/1985",
"12/08/1985",
"15/02/1983",
"24/08/1984",
"15/06/1977",
"25/10/1994",
"24/05/1988",
"25/02/1985",
"00/01/1900",
"07/11/1967",
"05/12/1961",
"04/09/1982",
"15/03/1982",
"02/02/1988",
"22/09/1974",
"12/10/1988",
"12/12/1987",
"00/01/1900",
"22/11/1964",
"12/02/1976",
"00/01/1900",
"28/01/1973",
"03/05/1982",
"30/01/1984",
"04/03/1991",
"27/06/1981",
"25/09/1982",
"00/01/1900",
"26/02/1981",
"00/01/1900",
"29/09/1993",
"00/01/1900",
"10/02/1966"
};
            if (birth_empleados[Bread.pos] == birth)
            {
                Bread.bandera = 1;
                return true;
            }
            else
            {
                return false;
            }
        }



        private async Task<bool> ValidateId(PromptValidatorContext<int> promptContext, CancellationToken cancellationToken)
        {
            int[] id_empleados = new int[] {1022,
                1035,
                1063,
                1138,
                1274,
                1278,
                1318,
                1329,
                1334,
                1335,
                1409,
                1420,
                1479,
                1621,
                1789,
                1790,
                1834,
                1998,
                2363,
                2439,
                2469,
                2521,
                2549,
                2561,
                2591,
                2634,
                2729,
                2801,
                2892,
                3009,
                3063,
                3125,
                3284,
                3372,
                3450,
                3520,
                3522,
                3523,
                3524,
                3525,
                3527,
                3529,
                3530,
                3531,
                3532,
                3533,
                3563,
                3639,
                3694,
                3734,
                3796,
                3798,
                3833,
                3846,
                3890,
                3897,
                3933,
                3978,
                4035,
                4036,
                4042,
                4043,
                4047,
                4057,
                4096,
                4125,
                4141,
                4221,
                4223,
                4224,
                4254,
                4262,
                4273,
                4302,
                4315,
                4322,
                4389,
                4412,
                4434,
                4549,
                4618,
                44975,
                44976,
                44990,
                44995,
                44997,
                45000,
                45003,
                45014,
                45023,
                45027,
                47017,
                0,
                1115,
                1483,
                2319,
                3426,
                3652,
                3751,
                3907,
                3911,
                4097,
                4295,
                4396,
                4424,
                4477,
                4523,
                4578,
                4617,
                44980,
                44987,
                45005,
                45019,
                0,
                1014,
                0,
                2113,
                2338,
                2394,
                2771,
                3417,
                3687,
                3706,
                4187,
                4266,
                4343,
                4393,
                45021,
                47013,
                0,
                1106,
                2825,
                2915,
                2954,
                3406,
                3421,
                3674,
                3716,
                3770,
                3863,
                3876,
                3903,
                3965,
                3981,
                4002,
                4029,
                4037,
                4051,
                4130,
                4170,
                4206,
                4264,
                4280,
                4286,
                4346,
                4364,
                4383,
                4404,
                4465,
                4475,
                4480,
                4485,
                4520,
                4532,
                4546,
                4547,
                4550,
                4551,
                4598,
                4609,
                4621,
                4628,
                4629,
                4632,
                4644,
                4645,
                4648,
                4653,
                4664,
                4670,
                4675,
                4678,
                4681,
                4684,
                4685,
                4686,
                4688,
                4689,
                4692,
                4697,
                4698,
                4699,
                4703,
                4704,
                0,
                2796,
                2797,
                2798,
                2803,
                4538,
                0,
                3896,
                3993,
                0,
                2376,
                2755,
                3228,
                3363,
                3543,
                3567,
                3698,
                3718,
                3753,
                3793,
                3801,
                3813,
                3979,
                4030,
                4071,
                4077,
                4145,
                4149,
                4151,
                4181,
                4196,
                4201,
                4258,
                4304,
                4312,
                4319,
                4327,
                4349,
                4369,
                4376,
                4386,
                4417,
                4442,
                4469,
                4564,
                4566,
                4594,
                4615,
                44978,
                44982,
                44993,
                44994,
                44999,
                45006,
                47007,
                47008,
                47015,
                47018,
                0,
                3167,
                3676,
                3708,
                3973,
                3999,
                4028,
                4301,
                4526,
                4634,
                4668,
                4669,
                4701,
                0,
                3080,
                3568,
                4086,
                4395,
                4608,
                45007,
                45016,
                45025,
                47005,
                47006,
                0,
                1129,
                3899,
                4204,
                4398,
                4405,
                4406,
                4410,
                4411,
                4413,
                4415,
                4429,
                4433,
                4436,
                4446,
                4452,
                4459,
                4471,
                4503,
                4574,
                44986,
                44989,
                45001,
                45004,
                45009,
                45010,
                45012,
                45015,
                45022,
                45024,
                45026,
                45028,
                45029,
                47011,
                47016,
                0,
                2800,
                3191,
                3679,
                3854,
                4115,
                4140,
                4249,
                4381,
                4498,
                4548,
                45008,
                45020,
                47014,
                0,
                3233,
                4337,
                4354,
                4464,
                4476,
                4478,
                4483,
                4501,
                4504,
                4511,
                4512,
                4516,
                4522,
                4534,
                4544,
                4569,
                4570,
                4576,
                4582,
                4595,
                4622,
                4624,
                4626,
                4631,
                4635,
                4641,
                4642,
                4643,
                4649,
                4657,
                4659,
                4661,
                4662,
                4667,
                4674,
                4677,
                4687,
                4694,
                4695,
                4700,
                4702,
                47002,
                47003,
                0,
                12815,
                22084,
                22107,
                22116,
                43106,
                43745,
                44162,
                44270,
                0,
                43488,
                43932,
                0,
                773,
                8385,
                11700,
                12910,
                14556,
                45002,
                0,
                47012,
                0,
                14118,
                0,
                7325};
            int count = promptContext.Recognized.Value;
            int bandera = 0;
            int contador = 0;
            foreach (int i in id_empleados)
            {
                if (count == i)
                {
                    bandera = 1;
                    Bread.pos = contador;
                }
                contador++;
            }
            if (bandera == 1)
            {
                return true;
            }
            else
            {
                return false;
            }
        }

        private async Task<DialogTurnResult> InitialStepAsync(WaterfallStepContext stepContext, CancellationToken cancellationToken)
        {
            return await stepContext.PromptAsync(
               nameof(NumberPrompt<int>),
               new PromptOptions
               {
                   Prompt = MessageFactory.Text("Bienvenid@, comparteme tu número de empleado, por favor"),
                   RetryPrompt = MessageFactory.Text("Por favor ingresa un número de empleado válido")
               },
               cancellationToken
           );
        }

        private async Task<DialogTurnResult> SetBirth(WaterfallStepContext stepContext, CancellationToken cancellationToken)
        {
            return await stepContext.PromptAsync(
               nameof(TextPrompt),
               new PromptOptions
               {
                   Prompt = MessageFactory.Text("Para validar tu identidad ingresa tu fecha de nacimiento, por favor (dd/mm/aaaa)"),
                   RetryPrompt = MessageFactory.Text("La fecha no coincide, por favor intenta de nuevo. Recuerda que el formato es (dd/mm/aaaa)")
               },
               cancellationToken
           );
        }
        private async Task<DialogTurnResult> FinalStepAsync(WaterfallStepContext stepContext, CancellationToken cancellationToken)
        {
            return await stepContext.EndDialogAsync(null, cancellationToken);

        }
    }
}